<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <!-- scheduled action-->
        <record id="ir_cron_auto_archive" model="ir.cron">
            <field name="name">Archive cancelled records that's been over a month.</field>
            <field name="model_id" ref="model_vehicle_repair"/>
            <field name="state">code</field>
            <field name="interval_number">1</field>
            <field name="interval_type">months</field>
            <field name="nextcall"
                   eval="(DateTime.now() + timedelta(days=30))"/>
            <field name="code">model.archive_cancelled()</field>
        </record>

        <!-- server action must be created for an automation rule -->
        <record id="update_customer_state" model="ir.actions.server">
            <field name="name">Update customer state</field>
            <field name="model_id" ref="vehicle_repair.model_vehicle_repair"/>
            <field name="binding_model_id" ref="vehicle_repair.model_vehicle_repair"/>
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">
                action = records.change_customer_state()
            </field>
        </record>

        <!-- automation rule -->
        <record id="change_contact_state_on_create" model="base.automation">
            <field name="name">Change state of customer when a record is created for vehicle repair</field>
            <field name="model_id" ref="vehicle_repair.model_vehicle_repair"/>
            <field name="trigger">on_create_or_write</field>
            <field name="action_server_ids" eval="[(4, ref('vehicle_repair.update_customer_state'))]"/>
        </record>
    </data>
</odoo>